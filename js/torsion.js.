(function () {
  const els = {
    T: document.getElementById('T'),
    L: document.getElementById('L'),
    d: document.getElementById('d'),
    G: document.getElementById('G'),
    btn: document.getElementById('compute'),
    out: document.getElementById('results'),
    canvas: document.getElementById('view')
  };
  const ctx = els.canvas.getContext('2d');

  function frame() {
    const { width:w, height:h } = els.canvas;
    ctx.clearRect(0,0,w,h);
    ctx.strokeRect(40,30,w-80,h-60);
    ctx.font = '14px system-ui';
    ctx.fillText('Torsion placeholder', 50, 50);
    // shaft
    ctx.fillRect(120, h/2 - 20, w-240, 40);
    // arrows
    ctx.beginPath();
    ctx.moveTo(80,h/2); ctx.lineTo(120,h/2); ctx.stroke();
    ctx.beginPath();
    ctx.moveTo(w-80,h/2); ctx.lineTo(w-120,h/2); ctx.stroke();
  }

  function compute() {
    // TODO: real math
    const T = +els.T.value;          // N·m
    const L = +els.L.value;          // m
    const d = +els.d.value;          // m
    const G = +els.G.value * 1e9;    // Pa
    const J = Math.PI*Math.pow(d,4)/32; // polar moment
    const theta = T*L/(G*J);            // rad
    const tauMax = (16*T)/(Math.PI*Math.pow(d,3))/1e6; // MPa
    els.out.textContent = `θ ≈ ${theta.toFixed(4)} rad, τ_max ≈ ${tauMax.toFixed(2)} MPa`;
    frame();
  }

  frame();
  els.btn.addEventListener('click', compute);
})();
